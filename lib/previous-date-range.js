// Generated by CoffeeScript 1.9.0
(function() {
  var PreviousDateRange, moment;

  moment = this.moment || require('moment');

  PreviousDateRange = (function() {
    PreviousDateRange.attributes = ['measure', 'units', 'whole'];

    function PreviousDateRange(data) {
      this.set(data);
      this.setDefaults();
    }

    PreviousDateRange.prototype.set = function(data) {
      var attr, _i, _len, _ref;
      if (data == null) {
        data = {};
      }
      _ref = this.constructor.attributes;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        attr = _ref[_i];
        if (data[attr] != null) {
          this[attr] = data[attr];
        }
      }
      return this;
    };

    PreviousDateRange.prototype.setDefaults = function() {
      if (this.measure == null) {
        this.measure = 'month';
      }
      if (this.units == null) {
        this.units = 1;
      }
      this.toDate = /ToDate$/.test(this.measure);
      return this.whole = !this.toDate;
    };

    PreviousDateRange.prototype.previous = function(_at_units, _at_measure, whole) {
      this.units = _at_units;
      this.measure = _at_measure;
      this.setDefaults();
      if (whole != null) {
        return this.whole = whole;
      }
    };

    PreviousDateRange.prototype.getRange = function(options) {
      var end, length, start;
      if (options == null) {
        options = {};
      }
      end = this.getEnd(options.startingFrom);
      start = this.getStart(end);
      length = 1 + end.diff(start, 'days');
      return {
        start: start,
        end: end,
        length: length
      };
    };

    PreviousDateRange.prototype.getEnd = function(fromDate) {
      var end;
      end = moment(fromDate);
      if (!this.whole) {
        return end.subtract(1, 'day');
      } else {
        return end.startOf(this.getCleanMeasure()).subtract(1, 'day').endOf(this.getCleanMeasure());
      }
    };

    PreviousDateRange.prototype.getStart = function(compareToDate) {
      var end;
      end = moment(compareToDate);
      if (!this.whole) {
        end.subtract(this.units, this.getCountableMeasure());
        if (this.toDate) {
          end.endOf(this.getCleanMeasure());
        }
        return end.add(1, 'day');
      } else {
        return end.subtract(this.units - 1, this.getCountableMeasure()).startOf(this.getCleanMeasure());
      }
    };

    PreviousDateRange.prototype.getCleanMeasure = function() {
      return this.measure.replace('ToDate', '');
    };

    PreviousDateRange.prototype.getCountableMeasure = function() {
      var cleanMeasure;
      cleanMeasure = this.getCleanMeasure();
      switch (cleanMeasure) {
        case 'isoWeek':
          return 'week';
        default:
          return cleanMeasure;
      }
    };

    PreviousDateRange.prototype.toJSON = function() {
      var attr, json, _i, _len, _ref;
      json = {};
      _ref = this.constructor.attributes;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        attr = _ref[_i];
        if (this[attr] != null) {
          json[attr] = this[attr];
        }
      }
      return json;
    };

    return PreviousDateRange;

  })();

  if ((typeof module !== "undefined" && module !== null ? module.exports : void 0) != null) {
    module.exports = PreviousDateRange;
  } else {
    this.PreviousDateRange = PreviousDateRange;
  }

}).call(this);
